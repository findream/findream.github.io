<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="findream's blog" type="application/atom+xml" />






<meta name="description" content="前言&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;C++反汇编及逆向分析技术">
<meta property="og:type" content="article">
<meta property="og:title" content="C++反汇编及逆向分析技术">
<meta property="og:url" content="http://yoursite.com/2019/01/31/C++反汇编及逆向分析技术/index.html">
<meta property="og:site_name" content="findream&#39;s blog">
<meta property="og:description" content="前言&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;C++反汇编及逆向分析技术">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://i.imgur.com/Lfz0auh.png">
<meta property="og:image" content="https://i.imgur.com/O4yT4Uc.png">
<meta property="og:image" content="https://i.imgur.com/qoDhJte.png">
<meta property="og:image" content="https://i.imgur.com/yrpbC9Y.png">
<meta property="og:updated_time" content="2019-07-01T07:44:50.636Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="C++反汇编及逆向分析技术">
<meta name="twitter:description" content="前言&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;C++反汇编及逆向分析技术">
<meta name="twitter:image" content="https://i.imgur.com/Lfz0auh.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/01/31/C++反汇编及逆向分析技术/"/>





  <title>C++反汇编及逆向分析技术 | findream's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">findream's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-schedule">
          <a href="/schedule/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br />
            
            日程表
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/31/C++反汇编及逆向分析技术/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="findream">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="findream's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">C++反汇编及逆向分析技术</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-31T15:02:11+08:00">
                2019-01-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/安全/" itemprop="url" rel="index">
                    <span itemprop="name">安全</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C++反汇编及逆向分析技术<br><a id="more"></a></p>
<h2 id="引用反汇编"><a href="#引用反汇编" class="headerlink" title="引用反汇编"></a>引用反汇编</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> &amp;nVar)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">	nVar++;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">mov</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">ebp</span>+<span class="number">4</span>]</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ecx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">eax</span>]</div><div class="line"><span class="keyword">add</span> <span class="built_in">ecx</span>,<span class="number">1</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">edx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">ebp</span>+<span class="number">8</span>]    <span class="comment">;解引用</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">edx</span>],<span class="built_in">ecx</span>      <span class="comment">;赋值</span></div></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;对于C++使用引用的情况，对于引用变量的修改是修改实参类型本身，第二：此时使用引用本身也会占据内存。</p>
<h2 id="常数"><a href="#常数" class="headerlink" title="常数"></a>常数</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;常量保存在常量数据区，一般在编译的时候就确定了数值，不可进行修改，<strong>常量首地址-基地址=Offset</strong>，这对应于在文件中的地址。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>#define和const的区别在于</strong>const是依赖于编译器在编译时期做检查，是一个伪常量。可以在运行时期利用指针做修改。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> a=<span class="number">5</span>;</div><div class="line"><span class="keyword">int</span> *Pa=&amp;a;   <span class="comment">//指针</span></div><div class="line">*Pa=<span class="number">6</span>;        <span class="comment">//修改</span></div></pre></td></tr></table></figure></p>
<h1 id="条件表达式"><a href="#条件表达式" class="headerlink" title="条件表达式"></a>条件表达式</h1><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;第一种情况，返回值的差为1<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> fun(<span class="keyword">int</span> a)</div><div class="line">&#123;</div><div class="line">	return a==<span class="number">5</span>??<span class="number">5</span>:<span class="number">6</span><span class="comment">;</span></div><div class="line">&#125;</div><div class="line">//反汇编如下：</div><div class="line"><span class="keyword">xor</span> <span class="built_in">eax</span>,<span class="built_in">eax</span></div><div class="line"><span class="keyword">cmp</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">ebp</span>+<span class="number">8</span>],<span class="number">5</span></div><div class="line"><span class="keyword">setne</span> <span class="built_in">al</span> <span class="comment">;如果zf=1，al=0，如果zf=0，则al=1</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">eax</span>,<span class="number">5</span></div></pre></td></tr></table></figure></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;第二种情况，返回值的差大于1<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> fun(<span class="keyword">int</span> a)</div><div class="line">&#123;</div><div class="line">	return a==<span class="number">5</span>??<span class="number">4</span>:<span class="number">10</span><span class="comment">;</span></div><div class="line">&#125;</div><div class="line">//反汇编如下：</div><div class="line"><span class="keyword">xor</span> <span class="built_in">eax</span>,<span class="built_in">eax</span></div><div class="line"><span class="keyword">sub</span> [<span class="built_in">ebp</span>+<span class="number">8</span>],<span class="number">5</span>   <span class="comment">;确定zf的数值</span></div><div class="line"><span class="keyword">neg</span> <span class="built_in">eax</span></div><div class="line"><span class="keyword">sbb</span> <span class="built_in">eax</span>,<span class="built_in">eax</span>     <span class="comment">;eax=eax-eax-zf,eax=0x00000000或者0xffffffff</span></div><div class="line"><span class="keyword">and</span> <span class="built_in">eax</span>，<span class="number">6</span>      <span class="comment">;如果eax=0xf，则结果为6，如果eax=0x0，则结果为0</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">eax</span>,<span class="number">4</span></div></pre></td></tr></table></figure></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;第三种情况，无优化<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> fun(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</div><div class="line">&#123;</div><div class="line">	return a?<span class="number">8</span>:n<span class="comment">;</span></div><div class="line">&#125;</div><div class="line">//反汇编如下：</div><div class="line"><span class="keyword">xor</span> <span class="built_in">eax</span>,<span class="built_in">eax</span></div><div class="line"><span class="keyword">cmp</span> [<span class="built_in">ebp</span>+<span class="number">8</span>],<span class="number">0</span></div><div class="line"><span class="keyword">je</span> xxxxx</div><div class="line"><span class="keyword">mov</span> <span class="built_in">eax</span>,<span class="number">8</span></div><div class="line"><span class="keyword">ret</span></div><div class="line"><span class="symbol">xxxx:</span><span class="keyword">mov</span> <span class="built_in">eax</span>,[<span class="built_in">ebp</span>+<span class="number">0xc</span>]</div><div class="line"><span class="keyword">ret</span></div></pre></td></tr></table></figure></p>
<h2 id="if—else-switch"><a href="#if—else-switch" class="headerlink" title="if—else/switch"></a>if—else/switch</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch语句和if-else语句反汇编的差异在于if语句后面接的是判断成立的语句块，判断条件不是在一块的，而switch语句判断条件是在一起的。<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">switch(a)</div><div class="line">&#123;</div><div class="line">	case <span class="number">1</span>:</div><div class="line">		b=<span class="number">1</span><span class="comment">;</span></div><div class="line">	case <span class="number">2</span>:</div><div class="line">        b=<span class="number">2</span><span class="comment">;</span></div><div class="line">    case <span class="number">3</span>:</div><div class="line">        b=<span class="number">3</span><span class="comment">;</span></div><div class="line">&#125;</div><div class="line">//反汇编如下</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ecx</span>,[<span class="built_in">ebp</span>-<span class="number">8</span>]</div><div class="line"><span class="keyword">mov</span> [<span class="built_in">ebp</span>-c],<span class="built_in">ecx</span></div><div class="line"><span class="keyword">cmp</span> [<span class="built_in">ebp</span>-c],<span class="number">1</span></div><div class="line"><span class="keyword">jz</span> xxxx_1</div><div class="line"><span class="keyword">cmp</span> [<span class="built_in">ebp</span>-c],<span class="number">2</span></div><div class="line"><span class="keyword">jz</span> xxxx_2</div><div class="line"><span class="keyword">cmp</span> [<span class="built_in">ebp</span>-c],<span class="number">3</span></div><div class="line"><span class="keyword">jz</span> xxxx_3</div><div class="line"><span class="keyword">jmp</span> xxxx_4</div><div class="line"><span class="symbol">xxxx_1:</span><span class="keyword">mov</span> <span class="built_in">eax</span>,<span class="number">1</span></div><div class="line"><span class="symbol">xxxx_2:</span><span class="keyword">mov</span> <span class="built_in">eax</span>,<span class="number">2</span></div><div class="line"><span class="symbol">xxxx_3:</span><span class="keyword">mov</span> <span class="built_in">eax</span>,<span class="number">3</span></div></pre></td></tr></table></figure></p>
<h2 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h2><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">mov reg/mem,xxx      ;赋初值</div><div class="line">jmp For_Cmp          ;跳转到循环条件判断</div><div class="line"><span class="comment">//计算循环步长度</span></div><div class="line"><span class="symbol">For_Step:</span>            </div><div class="line">mov reg,Step</div><div class="line">add reg,xxx         ;运算步长</div><div class="line">mov Step,reg        ;回写</div><div class="line"><span class="comment">//比较步长</span></div><div class="line">For_Cmp：</div><div class="line">mov ecx,Step</div><div class="line">cmp ecx,StepEnd     ;比较终止条件</div><div class="line">jxx For_End</div><div class="line">....                ;循环体</div><div class="line">jmp For_Step        ;回跳到计算循环步长</div><div class="line"><span class="symbol">For_End:</span></div><div class="line">``` </div><div class="line"></div><div class="line"><span class="meta">## 局部静态变量</span></div><div class="line"><span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;静态变量分为全局静态变量和局部静态变量，全局静态变量和全局变量是一致的。  </div><div class="line"><span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;局部静态变量的生命周期和全局变量是一致的，都是起于PE文件的编译阶段。但是作用域是不同的，局部静态变量的作用域是在&#123;&#125;之间。**也就是说局部静态变量会预先当做全局变量处理。**  <span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;如下代码：在Memory这个地址存在一个数据保存着局部静态变量的标志(这个地址在局部静态变量附近，以及这个地址可以保存八个静态局部变量)，在vc中通过与特定的位与特定的数(<span class="number">00000001</span>或者<span class="number">00000010</span>等)相或进行置<span class="number">1</span>操作。接着写入全局变量，这样做的好处是优化代码。</div></pre></td></tr></table></figure>
<p>xor eax,eax<br>mov al,[Memory]<br>and eax,1      ;al要么为1要么为0<br>test eax,eax   ;判断eax是否为0<br>jne xxxxxxx    ;如果不为0，跳转，标志这个标志位已经为1，也就是说这个数是局部静态变量<br>mov cl,[Memory];eax!=0<br>or cl,1        ;将cl特定的标志位置1，表示这个是局部静态变量<br>mov [Memory],cl<br>mov eax,[ebp+8]<br>mov [Static],eax  ;将局部静态变量写入全局变量区<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;但是他的作用域不和全局变量一致，我们利用变量名称粉碎实现分割作用域。</div><div class="line"></div><div class="line"><span class="meta">## 数组返回的危害</span></div><div class="line"><span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;当数组作为局部变量在函数中时，如果函数调用完成，退出时，esp指针会指向函数调用之前(维持栈的平衡)，此时函数内部的数组就可能被其他数据覆盖，这就会导致数组返回的不稳定。</div><div class="line"></div><div class="line"><span class="meta">## 索引寻址和指针寻址</span></div><div class="line"><span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;索引寻址比指针寻址来的更加直观，但是指针寻址更加灵活。索引寻址在汇编层只需要一次访存，而指针寻址需要两次访存。</div></pre></td></tr></table></figure></p>
<p>void a()<br>{<br>    char <em>Arr_a=NULL;<br>    char Arr_b[]=”Hello”；<br>    Arr_a=Arr_b;<br>    printf(“%c”,</em>Arr_a);<br>    printf(“%c”,Arr_b[0]);<br>}<br>//重点反汇编如下：<br>//指针寻址<br>mov eax,[ebp-4]  ;第一次访存<br>mov edx,[eax]    ;第二次访存<br>push edx<br>//索引寻址<br>mov eax,[ebp-0ch] ;第一次访存<br>push eax<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">## 数组指针与指针数组</span></div><div class="line"><span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;指针数组，顾名思义就是相同数据类型的指针构成的集合。格式为`Type *Name [n]`。  </div><div class="line"><span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;数组指针，及时指向数组的指针变量。数组的首地址就是一个指针。数组指针格式为`Type (*Name) [n]`。对于二维数组，指针数组可以指向每行的首地址,例如:`char Arr[<span class="number">3</span>][<span class="number">10</span>]=&#123;&#123;Hello&#125;，&#123;world&#125;,&#123;hhhhh&#125;&#125;。char (*Parr)[<span class="number">10</span>]=Arr`</div><div class="line"></div><div class="line"><span class="meta">## this指针</span></div><div class="line"><span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;this指针用于访问本类(实例)中的成员变量或者成员函数。如下代码，编译器利用ecx暂存This指针，如果要访问成员变量的时候，使用寄存器传参将将变量传递给你成员函数。这就是Thiscall</div></pre></td></tr></table></figure></p>
<p>class CTest<br>{<br>    int Num;<br>    public:<br>        void SetNumber(int Number)<br>        {<br>            Num=Number;<br>        }<br>}<br>void main(void)<br>{<br>    CTest Test;<br>    Test.SetNumber(5)；   //为CTest类成员变量Num赋初值<br>    printf(“%d”,Test.Num);<br>}<br>//反汇编代码main如下：<br>push 5   ;将参数5压栈<br>lea ecx [ebp-4]  ；将Test实例首地址存入ecx，This指针<br>call SetNumer;   ；调用SetNumber<br>mov eax,[ebp+8]  ;将参数传入print<br>push eax<br>psuh offset “%d”<br>call printf<br>add esp,8        ;thiscall，调用者清栈<br>//反汇编代码SetNumber(省略初始化过程)<br>mov [ebp-4],ecx    ;将this指针存入1内存<br>mov eax, [ebp-4]   ;将this指针存入eax<br>mov ecx ,[ebp+8]   ；将SetNumber第一个参数存入ecx<br>mov [eax],ecx      ；利用This指针，Num的地址为[eax+0],给Num赋值<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;在成员函数访问其他成员变量的时候，默认使用的是Thiscall调用约定，如果选用stdcall的话，就不会使用ecx传递This指针，而是使用栈。</div></pre></td></tr></table></figure></p>
<p>mov eax,[ebp+8] ;取出This指针<br>mov ecx,[ebp+c] ;取出参数<br>mov [eax],ecx   ;赋值给eax成员变量<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">## 静态数据成员</span></div><div class="line"><span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;静态数据成员在编译链接的时候已经产生，当程序被加载的时候，OS自动将其载入到对应的内存空间。也就是说当静态数据成员已经存在的时候，类还没有初始化。**即:静态数据成员的生存周期和类的生存周期是不一样的。**  </div><div class="line"><span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;第二点就是，静态数据变量不属于任何一个类，这就导致了静态数据变量和类之间是一对一的关系，从内存角度分析，静态数据成员和普通的数据成员不再相近(邻)的内存区域，**静态数据成员位于静态区，可以通过立即数寻址直接获取内存地址，而普通数据成员位于栈区。因为普通数据成员的地址是由实例化的类的地址确定的(具有不确定性)。**这也造成了计算类的大小时，不需要考虑静态数据成员。</div></pre></td></tr></table></figure></p>
<p>mov [ebp-8],1   ;普通数据成员<br>mov 4235bc,2    ;静态数据成员<br>lea ecx,[ebp-4];this指针<br>call showNumber<br>//showNumber内部<br>mov [ebp-4],ecx ;this指针<br>mov eax,[4235bc]<br>push eax        ;静态数据成员<br>mov ecx,[ebp-4] ;获取this指针<br>mov edx,[ecx]   ;通过this指针获取成员变量<br>push edx<br>push offset”%d”<br>call printf<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">## 构造函数</span></div><div class="line"></div><div class="line"><span class="meta">### 局部对象</span></div><div class="line"></div><div class="line"><span class="meta">### 堆对象</span></div><div class="line"><span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;<span class="variable">&amp;nbsp</span>;在创建堆对象的时候，经常使用new关键字进行创建。**编译器会自行检查new的返回结果，如果申请堆空间成功则会调用构造函数**这是识别堆对象的关键。</div></pre></td></tr></table></figure></p>
<p>push 4   ;压入类的大小<br>call operator new   ;<br>add esp,4<br>mov [ebp-18h],eax   ;保存new的返回值<br>mov [ebp-4],0       ；保存申请堆空间的次数<br>cmp [ebp-18h],0     ；判断堆空间是否申请成功，这是识别堆对象的重点<br>je xxxx             ;申请失败<br>mov ecx,[ebp-18h]   ;将对象首地址存入ecx<br>call Cnumber:Cnumber ;调用构造函数<br>```<br>    <img src="https://i.imgur.com/Lfz0auh.png" alt=""></p>
<h3 id="参数对象"><a href="#参数对象" class="headerlink" title="参数对象"></a>参数对象</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;当一个对象当做函数的参数进行传递的时候，参数对象就会发生复制，也就是说相当于拷贝了一个参数对象的副本。因此会触发拷贝构造函数。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;如果没有构造拷贝构造函数，编译器就会使用默认的拷贝构造函数。这种方式属于<strong>浅拷贝方式。</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在特殊情况下，使用默认拷贝构造函数可能会出错，应该自行构造拷贝构造函数，这种方式称为<strong>深拷贝。</strong><br>    <img src="https://i.imgur.com/O4yT4Uc.png" alt=""><br>    <img src="https://i.imgur.com/qoDhJte.png" alt=""><br>    <img src="https://i.imgur.com/yrpbC9Y.png" alt=""></p>
<h2 id="析构函数"><a href="#析构函数" class="headerlink" title="析构函数"></a>析构函数</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;当我们需要清理不用的内存的时候，首先需要使用析构代理函数间接调用析构函数。因为需要释放的对象不只一个，如果直接调用析构函数，可能无法实现多对象的释放。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/01/13/病毒分析技术_19_Ghost后门程序分析/" rel="next" title="病毒分析技术18) ---Ghost后门病毒">
                <i class="fa fa-chevron-left"></i> 病毒分析技术18) ---Ghost后门病毒
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/02/26/反虚拟机技术/" rel="prev" title="反虚拟机技术">
                反虚拟机技术 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">findream</p>
              <p class="site-description motion-element" itemprop="description">Apes--change the world's animals</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">110</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#引用反汇编"><span class="nav-number">2.</span> <span class="nav-text">引用反汇编</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#常数"><span class="nav-number">3.</span> <span class="nav-text">常数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#条件表达式"><span class="nav-number"></span> <span class="nav-text">条件表达式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#if—else-switch"><span class="nav-number">1.</span> <span class="nav-text">if—else/switch</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#for循环"><span class="nav-number">2.</span> <span class="nav-text">for循环</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#参数对象"><span class="nav-number">2.1.</span> <span class="nav-text">参数对象</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#析构函数"><span class="nav-number">3.</span> <span class="nav-text">析构函数</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">findream</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  

  

  

</body>
</html>
