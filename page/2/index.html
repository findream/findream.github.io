<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="findream's blog" type="application/atom+xml" />






<meta name="description" content="Apes--change the world&apos;s animals">
<meta property="og:type" content="website">
<meta property="og:title" content="findream&#39;s blog">
<meta property="og:url" content="https://findream.github.io/page/2/index.html">
<meta property="og:site_name" content="findream&#39;s blog">
<meta property="og:description" content="Apes--change the world&apos;s animals">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="findream&#39;s blog">
<meta name="twitter:description" content="Apes--change the world&apos;s animals">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://findream.github.io/page/2/"/>





  <title>findream's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">findream's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-schedule">
          <a href="/schedule/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br />
            
            日程表
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://findream.github.io/2019/02/26/一篇文章带你了解反虚拟机技术/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="findream">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="findream's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/26/一篇文章带你了解反虚拟机技术/" itemprop="url">一篇文章带你了解反虚拟机技术</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-26T15:02:11+08:00">
                2019-02-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/逆向工程/" itemprop="url" rel="index">
                    <span itemprop="name">逆向工程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="VMware痕迹"><a href="#VMware痕迹" class="headerlink" title="VMware痕迹"></a>VMware痕迹</h2><ul>
<li><p>1.检测Mac地址，以00:05:69、00:0c:29和00:50:56开始的MAC地址与VMware相对应；以00:03:ff开始的MAC地址与virtualpc对应；以08:00:27开始的MAC地址与virtualbox对应。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">BOOL CheckVMWare()  </div><div class="line">&#123;  </div><div class="line">    string <span class="keyword">mac</span>;  </div><div class="line">    get_3part_mac(<span class="keyword">mac</span>);    <span class="comment">//res =ioctl(sock,SIOCGIFHWADDR,&amp;ifr)获取Mac地址</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">mac</span>==<span class="string">"00-05-69"</span> || <span class="keyword">mac</span>==<span class="string">"00-0c-29"</span> || <span class="keyword">mac</span>==<span class="string">"00-50-56"</span>||<span class="keyword">mac</span>==<span class="string">"00-03-ff"</span>||<span class="keyword">mac</span>=="08-00-27)  </div><div class="line">    &#123;  </div><div class="line">        <span class="keyword">return</span> TRUE;  </div><div class="line">    &#125;  </div><div class="line">    <span class="keyword">else</span>  </div><div class="line">    &#123;  </div><div class="line">        <span class="keyword">return</span> FALSE;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>2.板序列号、主机型号、系统盘所在磁盘名称等其他硬件信息</p>
</li>
<li><p>3.根据当前进程信息，通过进程快照读取当前进程信息，查找是否存在虚拟机中特有的进程，如VMware中的<code>vmware.exe</code>和VirtualBox中的<code>VBoxService.exe</code>。</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">BOOL </span>CheckVMWare()  </div><div class="line">&#123;  </div><div class="line">    DWORD ret = <span class="number">0</span><span class="comment">;  </span></div><div class="line">    PROCESSENTRY32 pe32<span class="comment">;  </span></div><div class="line">    pe32.dwSize = sizeof(pe32)<span class="comment">;   </span></div><div class="line">    HANDLE hProcessSnap = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, <span class="number">0</span>)<span class="comment">;   </span></div><div class="line">    if(hProcessSnap == INVALID_HANDLE_VALUE)   </div><div class="line">    &#123;   </div><div class="line">        return FALSE<span class="comment">;   </span></div><div class="line">    &#125;  </div><div class="line">    <span class="keyword">BOOL </span><span class="keyword">bMore </span>= Process<span class="number">32F</span>irst(hProcessSnap, &amp;pe32)<span class="comment">;   </span></div><div class="line">    while(<span class="keyword">bMore) </span> </div><div class="line">    &#123; </div><div class="line">        if (!strcmp(pe32.szExeFile, <span class="string">"vmware.exe"</span>)<span class="title">||</span>!strcmp(pe32.szExeFile, <span class="string">"VBoxService.exe"</span>))  </div><div class="line">        &#123;  </div><div class="line">            return TRUE<span class="comment">;  </span></div><div class="line">        &#125;  </div><div class="line">        <span class="keyword">bMore </span>= Process32Next(hProcessSnap, &amp;pe32)<span class="comment">;   </span></div><div class="line">    &#125;  </div><div class="line">    <span class="keyword">CloseHandle(hProcessSnap); </span> </div><div class="line">    return FALSE<span class="comment">;  </span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>4.根据特定的文件夹或文件信息,通过查找磁盘中是否存在特定的文件夹或文件，判断当前是否在虚拟机中。VMware虚拟机中通常会有路径C:\Program Files\VMware\VMware Tools\；VirtualBox虚拟机中通常会有路径C:\Program Files\Oracle\VirtualBox Guest Additions\。</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">BOOL CheckVMware()  </div><div class="line">&#123; </div><div class="line">    if (!PathIsDirectory(<span class="string">"C:<span class="subst">\\</span>Program Files<span class="subst">\\</span>VMware<span class="subst">\\</span>VMware Tools<span class="subst">\\</span>"</span>)||!PathIsDirectory(<span class="string">"C:<span class="subst">\\</span>Program Files<span class="subst">\\</span>Oracle<span class="subst">\\</span>VirtualBox Guest Additions<span class="subst">\\</span>"</span>) )  </div><div class="line">    &#123;  </div><div class="line">        return <span class="literal">FALSE</span>;  </div><div class="line">    &#125;  </div><div class="line">    else  </div><div class="line">    &#123;  </div><div class="line">        return <span class="literal">TRUE</span>;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>5.根据特定注册表信息,通过读取主机具有虚拟机特性的注册表位置来判断是否处于虚拟机环境中。针对VMware可以判断注册表项HKEY_CLASSES_ROOT\Applications\VMwareHostOpen.exe；针对VirtualBox可以判断注册表项HKEY_LOCAL_MACHINE\SOFTWARE\Oracle\VirtualBox Guest Additions。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">BOOL</span> CheckVMWare()  </div><div class="line">&#123;  </div><div class="line">    HKEY hkey;  </div><div class="line">    <span class="keyword">if</span> (RegOpenKey(HKEY_CLASSES_ROOT, <span class="string">"\\Applications\\VMwareHostOpen.exe"</span>, &amp;hkey) == ERROR_SUCCESS)  </div><div class="line">    &#123;  </div><div class="line">        <span class="keyword">return</span> <span class="literal">TRUE</span>;  </div><div class="line">    &#125;  </div><div class="line">    <span class="keyword">else</span>  </div><div class="line">    &#123;  </div><div class="line">        <span class="keyword">return</span> <span class="literal">FALSE</span>;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>6.根据特定服务名,通过获取主机当前具有VMware特性的服务信息，判断当前主机是否为虚拟机。在VMware中通常会存在VMware物理磁盘助手服务和VMware Tools服务等；在VirtualBox中通常会存在VirtualBox Guest Additions Service服务等。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="function">BOOL <span class="title">CheckVMWare</span><span class="params">()</span>  </span></div><div class="line"><span class="function"></span>&#123;  </div><div class="line">    <span class="keyword">int</span> menu = <span class="number">0</span>;    </div><div class="line">    <span class="comment">//打开系统服务控制器    </span></div><div class="line">    SC_HANDLE SCMan = OpenSCManager(<span class="literal">NULL</span>, <span class="literal">NULL</span>, SC_MANAGER_ENUMERATE_SERVICE);   </div><div class="line">    <span class="keyword">if</span>(SCMan == <span class="literal">NULL</span>)    </div><div class="line">    &#123; </div><div class="line">        <span class="built_in">cout</span> &lt;&lt; GetLastError() &lt;&lt; <span class="built_in">endl</span>;  </div><div class="line">        <span class="built_in">printf</span>(<span class="string">"OpenSCManager Eorror/n"</span>);    </div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;    </div><div class="line">    &#125;    </div><div class="line">    <span class="comment">//保存系统服务的结构  </span></div><div class="line">    LPENUM_SERVICE_STATUSA service_status;     </div><div class="line">    DWORD cbBytesNeeded = <span class="literal">NULL</span>;     </div><div class="line">    DWORD ServicesReturned = <span class="literal">NULL</span>;    </div><div class="line">    DWORD ResumeHandle = <span class="literal">NULL</span>;    </div><div class="line">    service_status = (LPENUM_SERVICE_STATUSA)LocalAlloc(LPTR, <span class="number">1024</span> * <span class="number">64</span>);    </div><div class="line">    <span class="comment">//获取系统服务的简单信息    </span></div><div class="line">    <span class="keyword">bool</span> ESS = EnumServicesStatusA(SCMan, <span class="comment">//系统服务句柄    </span></div><div class="line">        SERVICE_WIN32, <span class="comment">//服务的类型    </span></div><div class="line">        SERVICE_STATE_ALL,  <span class="comment">//服务的状态    </span></div><div class="line">        (LPENUM_SERVICE_STATUSA)service_status,  <span class="comment">//输出参数，系统服务的结构    </span></div><div class="line">        <span class="number">1024</span> * <span class="number">64</span>,  <span class="comment">//结构的大小    </span></div><div class="line">        &amp;cbBytesNeeded, <span class="comment">//输出参数，接收返回所需的服务    </span></div><div class="line">        &amp;ServicesReturned, <span class="comment">//输出参数，接收返回服务的数量    </span></div><div class="line">        &amp;ResumeHandle); <span class="comment">//输入输出参数，第一次调用必须为0，返回为0代表成功    </span></div><div class="line">    <span class="keyword">if</span>(ESS == <span class="literal">NULL</span>)     </div><div class="line">    &#123;    </div><div class="line">        <span class="built_in">printf</span>(<span class="string">"EnumServicesStatus Eorror/n"</span>);    </div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;    </div><div class="line">    &#125;    </div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ServicesReturned; i++)    </div><div class="line">    &#123;    </div><div class="line">        <span class="keyword">if</span> (<span class="built_in">strstr</span>(service_status[i].lpDisplayName, <span class="string">"VMware Tools"</span>)!=<span class="literal">NULL</span> || <span class="built_in">strstr</span>(service_status[i].lpDisplayName, <span class="string">"VMware 物理磁盘助手服务"</span>)!=<span class="literal">NULL</span>||<span class="built_in">strstr</span>(service_status[i].lpDisplayName, <span class="string">"Virtual Machine"</span>)!=<span class="literal">NULL</span>)  </div><div class="line">        &#123;  </div><div class="line">            <span class="keyword">return</span> TRUE;  </div><div class="line">        &#125;  </div><div class="line">    &#125;    </div><div class="line">    <span class="comment">//关闭服务管理器的句柄   </span></div><div class="line">    CloseServiceHandle(SCMan);   </div><div class="line">    <span class="keyword">return</span> FALSE;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="漏洞指令"><a href="#漏洞指令" class="headerlink" title="漏洞指令"></a>漏洞指令</h2><ul>
<li><p>Red Pill<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Red Pill通过运行sidt指令获取IDTR寄存器的值。虚拟机监视器必须重新定位Guest系统的IDTR，来避免与Host系统的IDTR冲突。因为在虚拟机中运行sidt指令时，虚拟机监视器不会得到通知，所以会返回虚拟机的IDTR。Red Pill通过测试这种差异来探测Vmware的使用。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;如果检测到了sidt这个指令，说明很可能采用了反虚拟机技术</p>
</li>
<li><p>No Pill<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sgdt和sldt指令探测VMware的技术通常被称为No Pill</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">BOOL CheckVMWare()  </div><div class="line">&#123;  </div><div class="line">    ULONG xdt = <span class="number">0</span> <span class="comment">;  </span></div><div class="line">    ULONG InVM = <span class="number">0</span><span class="comment">;  </span></div><div class="line">    __asm  </div><div class="line">    &#123;  </div><div class="line">        <span class="keyword">push</span> <span class="built_in">edx</span>  </div><div class="line">        <span class="keyword">sidt</span> [<span class="built_in">esp</span>-<span class="number">2</span>]  </div><div class="line">        <span class="keyword">pop</span> <span class="built_in">edx</span>  </div><div class="line">        <span class="keyword">nop</span>  </div><div class="line">        <span class="keyword">mov</span> xdt , <span class="built_in">edx</span>  </div><div class="line">    &#125;  </div><div class="line">    if (xdt &gt; <span class="number">0xd0000000</span>)  </div><div class="line">    &#123;  </div><div class="line">        InVM = <span class="number">1</span><span class="comment">; </span></div><div class="line">    &#125;  </div><div class="line">    else  </div><div class="line">    &#123;  </div><div class="line">        InVM = <span class="number">0</span><span class="comment">;  </span></div><div class="line">    &#125;  </div><div class="line">    __asm  </div><div class="line">    &#123;  </div><div class="line">        <span class="keyword">push</span> <span class="built_in">edx</span>  </div><div class="line">        <span class="keyword">sgdt</span> [<span class="built_in">esp</span>-<span class="number">2</span>]  </div><div class="line">        <span class="keyword">pop</span> <span class="built_in">edx</span>  </div><div class="line">        <span class="keyword">nop</span>  </div><div class="line">        <span class="keyword">mov</span> xdt , <span class="built_in">edx</span>  </div><div class="line">    &#125;  </div><div class="line">    if (xdt &gt; <span class="number">0xd0000000</span>)  </div><div class="line">    &#123;  </div><div class="line">        InVM += <span class="number">1</span><span class="comment">;  </span></div><div class="line">    &#125;  </div><div class="line">    if (InVM == <span class="number">0</span>)  </div><div class="line">    &#123;  </div><div class="line">        return FALSE<span class="comment">;  </span></div><div class="line">    &#125;  </div><div class="line">    else  </div><div class="line">    &#123;  </div><div class="line">        return TRUE<span class="comment">;  </span></div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;通过禁用VMware加速可以防止No Pill技术的探测</p>
<ul>
<li><p>查询IO端口</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">BOOL CheckVMWare()  </div><div class="line">&#123;  </div><div class="line">    bool rc = true<span class="comment">;  </span></div><div class="line">    __try  </div><div class="line">    &#123;  </div><div class="line">        __asm  </div><div class="line">        &#123;  </div><div class="line">            <span class="keyword">push</span>   <span class="built_in">edx</span>  </div><div class="line">            <span class="keyword">push</span>   <span class="built_in">ecx</span>  </div><div class="line">            <span class="keyword">push</span>   <span class="built_in">ebx</span>    </div><div class="line">            <span class="keyword">mov</span>    <span class="built_in">eax</span>, <span class="string">'VMXh'</span>  //Magic数</div><div class="line">            <span class="keyword">mov</span>    <span class="built_in">ebx</span>, <span class="number">0</span>    </div><div class="line">            <span class="keyword">mov</span>    <span class="built_in">ecx</span>, <span class="number">10</span>   </div><div class="line">            <span class="keyword">mov</span>    <span class="built_in">edx</span>, <span class="string">'VX'</span>    //指定端口<span class="number">0x5668</span></div><div class="line">            <span class="keyword">in</span>     <span class="built_in">eax</span>, <span class="built_in">dx</span>      //返回值放入<span class="built_in">ebx</span></div><div class="line">            <span class="keyword">cmp</span>    <span class="built_in">ebx</span>, <span class="string">'VMXh'</span>   //返回值与Magic比较，为<span class="number">1</span>则处于虚拟机中</div><div class="line">            <span class="keyword">setz</span>   [rc]   </div><div class="line">            <span class="keyword">pop</span>    <span class="built_in">ebx</span>  </div><div class="line">            <span class="keyword">pop</span>    <span class="built_in">ecx</span>  </div><div class="line">            <span class="keyword">pop</span>    <span class="built_in">edx</span>  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">    __except(EXCEPTION_EXECUTE_HANDLER)    </div><div class="line">    &#123;  </div><div class="line">        rc = false<span class="comment">;  </span></div><div class="line">    &#125;  </div><div class="line">    return rc<span class="comment">;  </span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>总结：如下特权指令可以被用于反虚拟机，但是一般不使用：<code>sidt,sgdt,sldt,snsw,str,in,cpuid</code></p>
<h2 id="防范"><a href="#防范" class="headerlink" title="防范"></a>防范</h2></li>
<li>1.不安装vmware tools</li>
<li>2.不使用vm加速</li>
<li>3.分析时，检查特权指令，nop</li>
<li>4.不建议修改vmx文件，这是不高效的。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://findream.github.io/2019/01/13/病毒分析技术_18_Criakl勒索病毒/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="findream">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="findream's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/13/病毒分析技术_18_Criakl勒索病毒/" itemprop="url">病毒分析技术18) ---Criakl勒索病毒</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-13T11:02:11+08:00">
                2019-01-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/安全/" itemprop="url" rel="index">
                    <span itemprop="name">安全</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;病毒分析很心酸，真的会秃头。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这个是关于Criakl勒索病毒安全预警：<a href="https://baijiahao.baidu.com/s?id=1621544930994823264&amp;wfr=spider&amp;for=pc" target="_blank" rel="external">https://baijiahao.baidu.com/s?id=1621544930994823264&amp;wfr=spider&amp;for=pc</a>感谢这些安全专家吧，唉。不说了。头发真的都掉完了~~~</p>
<h1 id="一：目录"><a href="#一：目录" class="headerlink" title="一：目录"></a>一：目录</h1><ul>
<li>1.目录</li>
<li>2.Ioc</li>
<li>3.行为分析</li>
<li>4.样本分析</li>
<li>5.技术总结
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2019/01/13/病毒分析技术_18_Criakl勒索病毒/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://findream.github.io/2019/01/13/病毒分析技术_19_Ghost后门程序分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="findream">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="findream's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/13/病毒分析技术_19_Ghost后门程序分析/" itemprop="url">病毒分析技术18) ---Ghost后门病毒</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-13T11:02:11+08:00">
                2019-01-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/安全/" itemprop="url" rel="index">
                    <span itemprop="name">安全</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;后门病毒的前缀是：Backdoor。该类病毒的特性是通过网络传播，给系统开后门，给用户电脑带来安全隐患。2004年年初，IRC后门病毒开始在全球网络大规模出现。一方面有潜在的泄漏本地信息的危险，另一方面病毒出现在局域网中使网络阻塞，影响正常工作，从而造成损失。即使管理员通过改变所有密码之类的方法来提高安全性，仍然能再次侵入，使再次侵入被发现的可能性减至最低。<br>大多数后门设法躲过日志，大多数情况下即使入侵者正在使用系统也无法显示他已在线。<strong>摘录于百度百科</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;此次病毒多次使用隐藏技术，反复转移文件，以及使用Hook技术对抗分析。但是美中不足的是，释放样本的时候没有加密资源，直接获得了payload。</p>
<h1 id="一：目录"><a href="#一：目录" class="headerlink" title="一：目录"></a>一：目录</h1><ul>
<li>1.目录</li>
<li>2.Ioc</li>
<li>3.行为分析</li>
<li>4.样本分析</li>
<li>5.技术总结
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2019/01/13/病毒分析技术_19_Ghost后门程序分析/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://findream.github.io/2018/11/15/病毒分析技术_17_ CoinMiner挖矿病毒/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="findream">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="findream's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/15/病毒分析技术_17_ CoinMiner挖矿病毒/" itemprop="url">病毒分析技术(17) ---CoinMiner挖矿病毒</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-15T11:02:11+08:00">
                2018-11-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/安全/" itemprop="url" rel="index">
                    <span itemprop="name">安全</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;偶然在论坛上看到一篇关于CoinMiner介绍，文章从该病毒的流行趋势，入侵路径，关联分析等多个角度对病毒进行的分析，对样本的分析寥寥几句就概括完了。想到之前分析的多为勒索类病毒，对于挖矿类病毒研究较少。故斗胆尝试小小分析一次，如有不到之处望师傅们指教。</p>
<h1 id="一：目录"><a href="#一：目录" class="headerlink" title="一：目录"></a>一：目录</h1><ul>
<li>1.目录</li>
<li>2.样本信息</li>
<li>3.行为分析</li>
<li>4.样本分析</li>
<li>5.溯源分析</li>
</ul>
<h1 id="二：样本信息"><a href="#二：样本信息" class="headerlink" title="二：样本信息"></a>二：样本信息</h1><ul>
<li>1.样本名称：antspywares.exe</li>
<li>2.样本md5：3846b42b7ac29f8f92f6222230207cb5</li>
<li>3.是否加壳：无壳</li>
<li>4.编译语言：Microsoft Visual C++ ver. ~6.0~7.10 - Linker 14 - Visual 2015 </li>
<li>5.样本来源：<a href="http://93.174.93.149/" target="_blank" rel="external">http://93.174.93.149/</a></li>
</ul>
<h1 id="三：行为分析"><a href="#三：行为分析" class="headerlink" title="三：行为分析"></a>三：行为分析</h1><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;样本在技术上有所创新，首先没有直接使用Kernel32下的API函数，而是利用Knowdlls注册表优先在家Ntdll，然后获取其中的Nt*函数。第二，使用了进程替换技术，利用svchost.exe这一宿主进程，去启动挖矿进程，这样有效避免的被查杀的风险。但是实际操作中没有有效控制CPU的占用率，导致了被害者很容易觉察到。<br>    <img src="https://i.imgur.com/8mIM5jj.png" alt=""></p>
<h1 id="四：样本分析"><a href="#四：样本分析" class="headerlink" title="四：样本分析"></a>四：样本分析</h1><ul>
<li><p>1.程序在执行了初始化操作后，创建了一个名为<code>4e064bee1f3860fd606a</code>的互斥体，这一步目的是保证程序在此主机上是唯一的。如果检测到已存在次互斥体，程序退出。<br>  <img src="https://i.imgur.com/PKjcZEZ.png" alt=""></p>
</li>
<li><p>2.通过异或运算，解密得到配置文件地址，通过访问配置文件，我们可以看到钱包地址，矿池等相关配置信息。<br>  <img src="https://i.imgur.com/SBgTHTI.png" alt=""><br>  <img src="https://i.imgur.com/I0iMCaD.png" alt=""><br>  <img src="https://i.imgur.com/ZwU4MNQ.png" alt=""></p>
</li>
<li><p>3.再次通过相同的异或运算得到钱包地址，矿池地址<code>pool.monero.hashvault.pro:3333</code><br>  <img src="https://i.imgur.com/g9nRJCl.png" alt=""><br>  <img src="https://i.imgur.com/rpnwyaN.png" alt=""><br>  <img src="https://i.imgur.com/tyZob4d.png" alt=""><br>  <img src="https://i.imgur.com/wOsQMDq.png" alt=""></p>
</li>
<li><p>4.对病毒文件进行Hash加密 </p>
<ul>
<li>初始化CSP</li>
<li>创建空的Hash对象</li>
<li>将文件读入内存</li>
<li>将读入数据添加到指定Hash对象<br><img src="https://i.imgur.com/amBeAUN.png" alt=""><br><img src="https://i.imgur.com/alU1Uew.png" alt=""></li>
</ul>
</li>
<li><p>5.根据之前获得的系统位数(32位or64位)分别利用注册表<code>KnownDlls32</code>或者<code>KnowDlls</code>注册表项加载ntdll.dll，然后通过GetProcAddress函数获取指定函数地址。这样一来可以直接用Nt*函数，不需要Kernel32分发，也增大了分析人员分析的难度。<br>  <img src="https://i.imgur.com/oTnCKoj.png" alt=""><br>  <img src="https://i.imgur.com/r7rS9HU.png" alt=""></p>
</li>
<li><p>6.通过注册表<code>\\SOFTWARE\\Microsoft\\Cryptography</code>获取主机GUID值，目的是唯一的标志主机，在理论上GUID是每台主机唯一拥有的。也就是说每台主机的GUID值是不一样的。<br>  <img src="https://i.imgur.com/0wumWNB.png" alt=""><br>  <img src="https://i.imgur.com/T29WIq7.png" alt=""><br>  <img src="https://i.imgur.com/otkfSVm.png" alt=""><br>  <img src="https://i.imgur.com/JZc0eQc.png" alt=""></p>
</li>
<li><p>7.创建病毒释放目录<br>  <img src="https://i.imgur.com/LGFvRuR.png" alt=""><br>  <img src="https://i.imgur.com/dUNDo2k.png" alt=""></p>
</li>
<li><p>8.从网络中读取配置信息，可以发现这里的数据和前面的new.txt是一致的<br>  <img src="https://i.imgur.com/hj2CkBq.png" alt=""><br>  <img src="https://i.imgur.com/jElhNmG.png" alt=""><br>  <img src="https://i.imgur.com/0mTfea6.png" alt=""></p>
</li>
<li><p>9.判断svchost和wuapp.exe是否存在，这两个文件是系统文件，svchost是服务宿主程序，wuapp用于windows的更新，检查这两个程序存在的目的是为了后期利用这两个程序创建挖矿进程。<br>  <img src="https://i.imgur.com/Q2iq3sY.png" alt=""></p>
</li>
<li><p>10.创建两个配置文件<br>  <img src="https://i.imgur.com/DnkROSm.png" alt=""></p>
</li>
<li><p>11.在启动目录下创建<code>HpuEtzbXyw.url</code>文件，用于自启动.<br>  <img src="https://i.imgur.com/YFFCeC9.png" alt=""></p>
</li>
<li><p>12.创建挖矿进程，这里使用了进程替换技术。首先将代码跨进程写入svchost.exe中，然后通过sysenter汇编关键字resume。<br>  <img src="https://i.imgur.com/T3VFB0U.png" alt=""><br>  <img src="https://i.imgur.com/NPaJQ0r.png" alt=""><br>  <img src="https://i.imgur.com/NDLwOol.png" alt=""><br>  <img src="https://i.imgur.com/tAbDHoC.png" alt=""></p>
</li>
</ul>
<h1 id="五。溯源分析"><a href="#五。溯源分析" class="headerlink" title="五。溯源分析"></a>五。溯源分析</h1><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;根据管家团队的分析显示8220团队使用多个C&amp;C服务器，这样可以有效的避免被检测到。一下是8220团队使用到的C&amp;C服务器<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">159<span class="selector-class">.65</span><span class="selector-class">.155</span><span class="selector-class">.17</span></div><div class="line">93<span class="selector-class">.174</span><span class="selector-class">.93</span><span class="selector-class">.149</span></div><div class="line">198<span class="selector-class">.50</span><span class="selector-class">.179</span><span class="selector-class">.109</span></div><div class="line">193<span class="selector-class">.169</span><span class="selector-class">.252</span><span class="selector-class">.253</span></div><div class="line">192<span class="selector-class">.99</span><span class="selector-class">.142</span><span class="selector-class">.235</span></div></pre></td></tr></table></figure></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;同时样本中使用到的矿池地址是<code>pool.monero.hashvault.pro:3333</code>发现和其他厂商团队所报告的不符，可能是团队修改了其中的矿池。<br>    <img src="https://i.imgur.com/qwMBeVt.png" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://findream.github.io/2018/11/08/病毒分析技术_16_NotPetya/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="findream">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="findream's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/08/病毒分析技术_16_NotPetya/" itemprop="url">病毒分析技术(16) ---NotPetya勒索病毒</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-08T11:02:11+08:00">
                2018-11-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/安全/" itemprop="url" rel="index">
                    <span itemprop="name">安全</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NotPetya是源自类似Petya的全新形式勒索病毒，可以将硬盘整个加密和锁死，从内存或者本地文件系统里提取密码。[源自于百度百科]</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本篇分析的关于MBR修改一节部分参照了前辈maydayRn 的分析结果。<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/11/08/病毒分析技术_16_NotPetya/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://findream.github.io/2018/09/10/病毒分析技术_15_sata勒索病毒/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="findream">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="findream's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/10/病毒分析技术_15_sata勒索病毒/" itemprop="url">病毒分析技术_15_sata勒索病毒</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-10T10:45:11+08:00">
                2018-09-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/安全/" itemprop="url" rel="index">
                    <span itemprop="name">安全</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="一：目录"><a href="#一：目录" class="headerlink" title="一：目录"></a>一：目录</h1><ul>
<li>1.目录</li>
<li>2.样本信息</li>
<li>3.样本分析</li>
<li>4.技术总计
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/09/10/病毒分析技术_15_sata勒索病毒/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://findream.github.io/2018/09/04/《格蠹汇编》_第29章_在调试器中细品CPU/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="findream">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="findream's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/04/《格蠹汇编》_第29章_在调试器中细品CPU/" itemprop="url"><格蠹汇编>_第29章_在调试中细品CPU</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-04T15:02:11+08:00">
                2018-09-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/格蠹汇编/" itemprop="url" rel="index">
                    <span itemprop="name"><格蠹汇编></span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="引用栈上的变量"><a href="#引用栈上的变量" class="headerlink" title="引用栈上的变量"></a>引用栈上的变量</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;通常，在函数入口处会执行以下代码,这样子函数的栈底就是父函数栈顶。在ebp值上面的空间就是子函数需要使用的栈空间，下面是父函数使用的栈空间。所以<strong>ebp+正数代表的是传入子函数的参数，ebp+负数代表的是子函数的局部变量。</strong><br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">push</span> <span class="built_in">esp</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ebp</span>, <span class="built_in">esp</span></div></pre></td></tr></table></figure></p>
<h2 id="淡化段机制"><a href="#淡化段机制" class="headerlink" title="淡化段机制"></a>淡化段机制</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;操作系统大都使用分页机制作为内存管理的主要手段，这是因为段机制是不可禁止的，同时考虑到软件的兼容性，只能淡化段机制的作用。比如讲段基地址设置为0，边界设置为最大，再如共享段描述符。让不同的进程使用相同的段描述符，这就是调试不同的程序但是其段地址是相同的了。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;每个CPU都有自己的<strong>全局描述表(GDT)</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;如下图，后面的数值表示的是段描述符在全局描述表的位置，<strong>当段选择子的第三位全部置零后得到对应的段描述符的偏移值。</strong>例如在cs的值为0x1b，但是对应的段描述符表的偏移则是0x18，对应的就是全局描述符表的KGDT_R3_CODE.<br>    <img src="https://i.imgur.com/cLzQ0F8.png" alt=""></p>
<h2 id="特殊的FS段"><a href="#特殊的FS段" class="headerlink" title="特殊的FS段"></a>特殊的FS段</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;windows中FS寄存器有特殊的用法，当CPU在内核中运行时，FS指向的是PCR，当CPU在用户态运行时，FS指向的是TEB。利用<code>dg命令</code>可以查看段描述信息。如下可以发现，使用dg 38和!teb查看的FS指向的TEB结构的基地址都是相同的。<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="number">0</span><span class="string">:009&gt;</span> <span class="string">dg</span> <span class="number">38</span></div><div class="line">                                  <span class="string">P</span> <span class="string">Si</span> <span class="string">Gr</span> <span class="string">Pr</span> <span class="string">Lo</span></div><div class="line"><span class="string">Sel</span>    <span class="string">Base</span>     <span class="string">Limit</span>     <span class="string">Type</span>    <span class="string">l</span> <span class="string">ze</span> <span class="string">an</span> <span class="string">es</span> <span class="string">ng</span> <span class="string">Flags</span></div><div class="line"><span class="bullet">-</span><span class="meta">---</span> <span class="bullet">--------</span> <span class="bullet">--------</span> <span class="bullet">----------</span> <span class="bullet">-</span> <span class="bullet">--</span> <span class="bullet">--</span> <span class="bullet">--</span> <span class="bullet">--</span> <span class="bullet">--------</span></div><div class="line"><span class="number">0038</span> <span class="number">7</span><span class="string">ffd5000</span> <span class="number">00000</span><span class="string">fff</span> <span class="string">Data</span> <span class="string">RW</span> <span class="string">Ac</span> <span class="number">3</span> <span class="string">Bg</span> <span class="string">By</span> <span class="string">P</span>  <span class="string">Nl</span> <span class="number">000004</span><span class="string">f3</span></div><div class="line"><span class="number">0</span><span class="string">:009&gt;</span> <span class="string">!teb</span></div><div class="line"><span class="string">TEB</span> <span class="string">at</span> <span class="number">7</span><span class="string">ffd5000</span></div><div class="line"><span class="attr">    ExceptionList:</span>        <span class="number">02</span><span class="string">eaffe4</span></div><div class="line"><span class="attr">    StackBase:</span>            <span class="number">02</span><span class="string">eb0000</span></div><div class="line"><span class="attr">    StackLimit:</span>           <span class="number">02</span><span class="string">eaf000</span></div><div class="line"><span class="attr">    SubSystemTib:</span>         <span class="number">00000000</span></div><div class="line"><span class="attr">    FiberData:</span>            <span class="number">00001e00</span></div><div class="line"><span class="attr">    ArbitraryUserPointer:</span> <span class="number">00000000</span></div><div class="line"><span class="attr">    Self:</span>                 <span class="number">7</span><span class="string">ffd5000</span></div><div class="line"><span class="attr">    EnvironmentPointer:</span>   <span class="number">00000000</span></div><div class="line"><span class="attr">    ClientId:</span>             <span class="number">000001</span><span class="string">b8</span> <span class="string">.</span> <span class="number">00000</span><span class="string">ae4</span></div><div class="line"><span class="attr">    RpcHandle:</span>            <span class="number">00000000</span></div><div class="line">    <span class="string">Tls</span> <span class="attr">Storage:</span>          <span class="number">00000000</span></div><div class="line">    <span class="string">PEB</span> <span class="attr">Address:</span>          <span class="number">7</span><span class="string">ffdf000</span></div><div class="line"><span class="attr">    LastErrorValue:</span>       <span class="number">0</span></div><div class="line"><span class="attr">    LastStatusValue:</span>      <span class="number">0</span></div><div class="line">    <span class="string">Count</span> <span class="string">Owned</span> <span class="attr">Locks:</span>    <span class="number">0</span></div><div class="line"><span class="attr">    HardErrorMode:</span>        <span class="number">0</span></div></pre></td></tr></table></figure></p>
<h2 id="我是谁？"><a href="#我是谁？" class="headerlink" title="我是谁？"></a>我是谁？</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PCR处理器控制区是用于存放CPU的编号，IDT和GDT表和重要状态的内存区域，使用<code>!pcr命令</code>可以查看信息<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="string">kd&gt;</span> <span class="string">!pcr</span></div><div class="line"><span class="string">KPCR</span> <span class="string">for</span> <span class="string">Processor</span> <span class="number">0</span> <span class="string">at</span> <span class="attr">ffdff000:</span></div><div class="line">    <span class="string">Major</span> <span class="number">1</span> <span class="string">Minor</span> <span class="number">1</span></div><div class="line">	<span class="string">NtTib.ExceptionList:</span> <span class="number">8054</span><span class="string">a4b0</span></div><div class="line">	    <span class="string">NtTib.StackBase:</span> <span class="number">8054</span><span class="string">acf0</span></div><div class="line">	   <span class="string">NtTib.StackLimit:</span> <span class="number">80547</span><span class="string">f00</span></div><div class="line">	 <span class="string">NtTib.SubSystemTib:</span> <span class="number">00000000</span></div><div class="line">	      <span class="string">NtTib.Version:</span> <span class="number">00000000</span></div><div class="line">	  <span class="string">NtTib.UserPointer:</span> <span class="number">00000000</span></div><div class="line">	      <span class="string">NtTib.SelfTib:</span> <span class="number">00000000</span></div><div class="line"></div><div class="line">	            <span class="attr">SelfPcr:</span> <span class="string">ffdff000</span></div><div class="line">	               <span class="attr">Prcb:</span> <span class="string">ffdff120</span></div><div class="line">	               <span class="attr">Irql:</span> <span class="number">00000000</span></div><div class="line">	                <span class="attr">IRR:</span> <span class="number">00000000</span></div><div class="line">	                <span class="attr">IDR:</span> <span class="string">ffffffff</span></div><div class="line">	      <span class="attr">InterruptMode:</span> <span class="number">00000000</span></div><div class="line">	                <span class="attr">IDT:</span> <span class="number">8003</span><span class="string">f400</span></div><div class="line">	                <span class="attr">GDT:</span> <span class="number">8003</span><span class="string">f000</span></div><div class="line">	                <span class="attr">TSS:</span> <span class="number">80042000</span></div><div class="line"></div><div class="line">	      <span class="attr">CurrentThread:</span> <span class="number">80553740</span></div><div class="line">	         <span class="attr">NextThread:</span> <span class="number">00000000</span></div><div class="line">	         <span class="attr">IdleThread:</span> <span class="number">80553740</span></div><div class="line"></div><div class="line">	          <span class="attr">DpcQueue:</span>  <span class="number">0x80553da0</span> <span class="number">0x80500df0</span> <span class="string">[Normal]</span> <span class="string">nt!KiTimerExpiration</span></div><div class="line"><span class="string">kd&gt;</span> <span class="string">dg</span> <span class="number">30</span></div><div class="line">                                  <span class="string">P</span> <span class="string">Si</span> <span class="string">Gr</span> <span class="string">Pr</span> <span class="string">Lo</span></div><div class="line"><span class="string">Sel</span>    <span class="string">Base</span>     <span class="string">Limit</span>     <span class="string">Type</span>    <span class="string">l</span> <span class="string">ze</span> <span class="string">an</span> <span class="string">es</span> <span class="string">ng</span> <span class="string">Flags</span></div><div class="line"><span class="bullet">-</span><span class="meta">---</span> <span class="bullet">--------</span> <span class="bullet">--------</span> <span class="bullet">----------</span> <span class="bullet">-</span> <span class="bullet">--</span> <span class="bullet">--</span> <span class="bullet">--</span> <span class="bullet">--</span> <span class="bullet">--------</span></div><div class="line"><span class="number">0030</span> <span class="string">ffdff000</span> <span class="number">00001</span><span class="string">fff</span> <span class="string">Data</span> <span class="string">RW</span> <span class="string">Ac</span> <span class="number">0</span> <span class="string">Bg</span> <span class="string">Pg</span> <span class="string">P</span>  <span class="string">Nl</span> <span class="number">00000</span><span class="string">c93</span></div></pre></td></tr></table></figure></p>
<h2 id="不可缺少的TSS段"><a href="#不可缺少的TSS段" class="headerlink" title="不可缺少的TSS段"></a>不可缺少的TSS段</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TSS段，用于存放一个任务的执行状态的段，一般的会给每个任务分配一个TSS段，便于进行任务的切换，但是，windows这样的操作系统只是创建少数的TSS段，例如KGDT_TSS,KGDT_DF_TSS和KGDT_NMI_TSS，但是后面两个TSS是处理双误和不可屏蔽中断的任务切换的，也就是说，CPU会根据这两个TSS进行任务切换，<strong>关于第一个TSS是所有线程共享的</strong>，它的内容是随着任务的切换而改变的，也就是说os在切换线程时候，并不跟换TSS，而是更新TSS的内容。</p>
<h2 id="拓展到64位"><a href="#拓展到64位" class="headerlink" title="拓展到64位"></a>拓展到64位</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;和x32相比，x64取消了硬件方式下的任务切换，对TSS结构发生了很大修改。但是硬件还是保留了自动切换栈的功能，新增了一个名为IST的域。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://findream.github.io/2018/09/03/病毒分析技术_14_Wannamine2.0挖矿病毒/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="findream">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="findream's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/03/病毒分析技术_14_Wannamine2.0挖矿病毒/" itemprop="url">病毒分析技术_14_Wannamine2.0挖矿病毒</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-03T10:45:11+08:00">
                2018-09-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/安全/" itemprop="url" rel="index">
                    <span itemprop="name">安全</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Wannamine2.0是wannamine家族的变种。该家族特征是使用NSA泄露的eternalblue漏洞利用工具包+扫描传播模块+挖矿木马，一切未打ms17-010漏洞补丁的机器都将是其目标，对于网络中存在ms17-010漏洞的机器而言，它是不可忽视的安全威胁。该挖矿木马为了躲避杀毒软件查杀，特地将主控程序加密并放到资源EnrollCertXaml.dll中。样本通过MS17-010（永恒之蓝）漏洞进行传播，其漏洞利用模块是使用的NSA工具包eternalblue和doublepuls，即2017年影子经纪人所公开的NSA工具包，定时和C&amp;C进行连接接受命令和更新模块，主要目的为挖掘门罗币。<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/09/03/病毒分析技术_14_Wannamine2.0挖矿病毒/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://findream.github.io/2018/08/28/《格蠹汇编》_第25章_如何调试窗口大总管/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="findream">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="findream's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/28/《格蠹汇编》_第25章_如何调试窗口大总管/" itemprop="url"><格蠹汇编>_第25章_如何调试窗口大总管</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-28T15:02:11+08:00">
                2018-08-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/格蠹汇编/" itemprop="url" rel="index">
                    <span itemprop="name"><格蠹汇编></span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="神圣不可侵犯"><a href="#神圣不可侵犯" class="headerlink" title="神圣不可侵犯"></a>神圣不可侵犯</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CSRSS进程，中文全称是系统服务进程，他监管着系统中运行的所有windows进程和线程。在消息分发，桌面管理，终端登录，控制台管理，DOS虚拟机等方面起着重要作用。由于其重要性，调试CSRSS进程也是相当困难的<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/08/28/《格蠹汇编》_第25章_如何调试窗口大总管/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://findream.github.io/2018/08/27/《格蠹汇编》_第21章_趣谈托管程序的辅助调试线程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="findream">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="findream's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/27/《格蠹汇编》_第21章_趣谈托管程序的辅助调试线程/" itemprop="url"><格蠹汇编>_第9章_趣谈托管程序的辅助调试线程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-27T15:02:11+08:00">
                2018-08-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/格蠹汇编/" itemprop="url" rel="index">
                    <span itemprop="name"><格蠹汇编></span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;当执行windows可执行文件时，OS会创建一个线程，叫做<strong>初始线程</strong>，应用程序的主函数都是在这个线程里面执行的。<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/08/27/《格蠹汇编》_第21章_趣谈托管程序的辅助调试线程/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">findream</p>
              <p class="site-description motion-element" itemprop="description">Apes--change the world's animals</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">49</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">findream</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  

  

  

</body>
</html>
